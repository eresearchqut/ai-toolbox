"use strict";(self.webpackChunkai_toolbox=self.webpackChunkai_toolbox||[]).push([[72],{"./src/components/tool/guide/HuggingFacePipeline/Instructions.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LyraGPU:()=>LyraGPU,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__={title:"Tools/HuggingFacePipeline/HuggingFaceInstructions",component:__webpack_require__("./src/components/tool/guide/HuggingFacePipeline/HuggingFaceInstructions.js").k},LyraGPU={args:{task:"text-generation",model:"bigscience/bloom",config:{service:"Lyra",hardware:"GPU",cpuVendor:"Any",cpus:8,ram:32,gpuVendor:"NVIDIA",gpuModel:"A100",gpuModules:8,tool:"CLI",environment:"Singularity"},port:3456},argTypes:{config:{tool:{control:{type:"select",options:["CLI","API"]}}}}},__namedExportsOrder=["LyraGPU"];LyraGPU.parameters={...LyraGPU.parameters,docs:{...LyraGPU.parameters?.docs,source:{originalSource:'{\n  args: {\n    task: "text-generation",\n    model: "bigscience/bloom",\n    config: {\n      service: "Lyra",\n      hardware: "GPU",\n      cpuVendor: "Any",\n      cpus: 8,\n      ram: 32,\n      gpuVendor: "NVIDIA",\n      gpuModel: "A100",\n      gpuModules: 8,\n      tool: "CLI",\n      environment: "Singularity"\n    },\n    port: 3456\n  },\n  argTypes: {\n    config: {\n      tool: {\n        control: {\n          type: "select",\n          options: ["CLI", "API"]\n        }\n      }\n    }\n  }\n}',...LyraGPU.parameters?.docs?.source}}}},"./src/components/tool/guide/HuggingFacePipeline/HuggingFaceInstructions.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{k:()=>HuggingFaceInstructions});var chunk_PULVB27S=__webpack_require__("./node_modules/@chakra-ui/layout/dist/chunk-PULVB27S.mjs"),chunk_LZZHVJFG=__webpack_require__("./node_modules/@chakra-ui/layout/dist/chunk-LZZHVJFG.mjs"),react=__webpack_require__("./node_modules/react/index.js"),useLocalStorageState=__webpack_require__("./src/components/hooks/useLocalStorageState.js"),TextWithLink=__webpack_require__("./src/components/navigation/TextWithLink.js"),CommandBox=__webpack_require__("./src/components/output/CommandBox.js"),PreformattedBox=__webpack_require__("./src/components/output/PreformattedBox.js"),InstructionHeading=__webpack_require__("./src/components/tool/guide/Instructions/components/InstructionHeading.js"),InstructionText=__webpack_require__("./src/components/tool/guide/Instructions/components/InstructionText.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function AccessInstructions(_ref){let{service,port,node,username}=_ref;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Lyra"===service&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(InstructionHeading.Z,{children:"Forward the port"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"In a new terminal window, run the following command to forward traffic from the server to your local machine:"}),""===username&&(0,jsx_runtime.jsx)(InstructionText.Z,{children:(0,jsx_runtime.jsxs)("i",{children:["Replace ",(0,jsx_runtime.jsx)(chunk_LZZHVJFG.E,{children:"username"})," with your QUT username."]})}),""===node&&(0,jsx_runtime.jsx)(InstructionText.Z,{children:(0,jsx_runtime.jsxs)("i",{children:["Replace ",(0,jsx_runtime.jsx)(chunk_LZZHVJFG.E,{children:"node"})," with the name of the node the job is running on."]})}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:`ssh -L ${port}:${node||"node"}:${port} ${username||"username"}@lyra.qut.edu.au`})]}),(0,jsx_runtime.jsx)(InstructionHeading.Z,{children:"Access the tool"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:(0,jsx_runtime.jsx)(TextWithLink.Z,{textBeforeLink:"In your web browser, navigate to the following address: ",link:{href:`http://localhost:${port}`,text:`http://localhost:${port}`,color:"blue.500",isExternal:!0}})}),(0,jsx_runtime.jsxs)(PreformattedBox.Z,{children:["http://localhost:",port]})]})}AccessInstructions.__docgenInfo={description:"",methods:[],displayName:"AccessInstructions"};var ConnectInstructions=__webpack_require__("./src/components/tool/guide/Instructions/ConnectInstructions.js"),InstallInstructions=__webpack_require__("./src/components/tool/guide/Instructions/InstallInstructions.js"),InstructionInput=__webpack_require__("./src/components/tool/guide/Instructions/InstructionInput.js");function RunInstructions(_ref){let{service,tool,task,model,port}=_ref;const isWorkstation=["rVDI","Local"].includes(service);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(InstructionHeading.Z,{children:"Run the gradio server"}),"CLI"===tool&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Start the gradio server:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:`gradio pipeline ${task} --model=${model} --server-name="0.0.0.0" --server-port=${port} --device-map="auto"`})]}),"Script"===tool&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(InstructionText.Z,{children:["Save the following to a file named ",(0,jsx_runtime.jsx)(chunk_LZZHVJFG.E,{children:"hf_pipeline.py"})]}),(0,jsx_runtime.jsx)(PreformattedBox.Z,{children:`import gradio\nimport transformers\nimport sys\n\nTASK = "${task}"\nMODEL = "${model}"\nPORT = int(sys.argv[1])\n\nprint(f"Starting: {TASK=} {MODEL=} {PORT=}", file=sys.stderr)\nprint("Please wait while the model loads into memory...", file=sys.stderr)\n\npipeline = transformers.pipeline(TASK, model=MODEL, device_map="auto")\ninterface = gradio.Interface.from_pipeline(pipeline)\ninterface.launch(server_name="0.0.0.0", server_port=PORT)\n`}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Run the script:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:`python hf_pipeline.py ${port}`})]}),"Notebook"===tool&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[isWorkstation&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Run the following command to start the server:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"python -m jupyterlab"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Open the link to the jupyter server in your browser, and create a new notebook."})]}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Execute the following code in the notebook:"}),(0,jsx_runtime.jsx)(PreformattedBox.Z,{children:`import gradio\nimport transformers\n\nTASK = "${task}"\nMODEL = "${model}"\nPORT = ${port}\n\npipeline = transformers.pipeline(TASK, model=MODEL, device_map="auto")\ninterface = gradio.Interface.from_pipeline(pipeline)\ninterface.launch(server_name="0.0.0.0", server_port=PORT)\n`})]})]})}RunInstructions.__docgenInfo={description:"",methods:[],displayName:"RunInstructions"};var StartInstructions=__webpack_require__("./src/components/tool/guide/Instructions/StartInstructions.js"),TeardownInstructions=__webpack_require__("./src/components/tool/guide/Instructions/TeardownInstructions.js");const TEXT_PATTERN=/^[a-z0-9]*$/;function HuggingFaceInstructions(_ref){let{task,model,config,port}=_ref;const[username,setUsername]=(0,useLocalStorageState.Z)("qutUsername","qutusername"),[node,setNode]=(0,react.useState)("");return(0,jsx_runtime.jsxs)(chunk_PULVB27S.xu,{children:["Lyra"===config.service&&(0,jsx_runtime.jsx)(InstructionInput.Z,{label:"QUT Username",placeholder:"username",value:username,onChange:setUsername,pattern:TEXT_PATTERN,helperText:"Optionally enter your QUT username so that it can be pre-populated in the commands below.",errorText:"Username must only contain lowercase letters and numbers"}),(0,jsx_runtime.jsx)(ConnectInstructions.s,{service:config.service,username}),"Lyra"===config.service&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(StartInstructions.Wh,{jobType:"Interactive",hardware:config.hardware,cpuVendor:config.cpuVendor,cpuModel:config.cpuModel,cpus:config.cpus,ram:config.ram,gpuVendor:config.gpuVendor,gpuModel:config.gpuModel,gpuModules:config.gpuModules,wallTime:config.wallTime,jobInstanceType:config.jobInstanceType,arrayConfig:config.arrayConfig}),(0,jsx_runtime.jsxs)(InstructionText.Z,{children:["Wait for the job to start, and take note of the node you are on (eg."," ",(0,jsx_runtime.jsx)(chunk_LZZHVJFG.E,{children:"cl5n042"}),")."]}),(0,jsx_runtime.jsx)(InstructionInput.Z,{label:"Node name",placeholder:"node",value:node,onChange:setNode,pattern:TEXT_PATTERN,helperText:"Optionally enter the name of the node so that it can be pre-populated in the commands below.",errorText:"Node name must only contain lowercase letters and numbers"})]}),"JupyterHub"===config.service&&(0,jsx_runtime.jsx)(StartInstructions.CJ,{jobProfile:config.jobProfile}),"rVDI"===config.service&&(0,jsx_runtime.jsx)(StartInstructions.HW,{hardware:config.hardware,os:config.os}),"Local"===config.service&&(0,jsx_runtime.jsx)(StartInstructions.Bc,{hardware:config.hardware,os:config.os}),(0,jsx_runtime.jsx)(InstallInstructions._,{hardware:config.hardware,gpuVendor:config.gpuVendor,service:config.service,tool:config.tool,environment:config.environment}),(0,jsx_runtime.jsx)(RunInstructions,{service:config.service,tool:config.tool,task,model,port}),(0,jsx_runtime.jsx)(AccessInstructions,{service:config.service,port,node,username}),(0,jsx_runtime.jsx)(TeardownInstructions.v,{service:config.service,environment:config.environment,usingTool:!0})]})}HuggingFaceInstructions.__docgenInfo={description:"",methods:[],displayName:"HuggingFaceInstructions"}},"./src/components/tool/guide/Instructions/InstallInstructions.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>InstallInstructions});var chunk_GTRZJDIL=__webpack_require__("./node_modules/@chakra-ui/tabs/dist/chunk-GTRZJDIL.mjs"),chunk_BXDFYXZJ=__webpack_require__("./node_modules/@chakra-ui/tabs/dist/chunk-BXDFYXZJ.mjs"),chunk_IAXSQ4X2=__webpack_require__("./node_modules/@chakra-ui/tabs/dist/chunk-IAXSQ4X2.mjs"),chunk_4YMKQ5D4=__webpack_require__("./node_modules/@chakra-ui/tabs/dist/chunk-4YMKQ5D4.mjs"),chunk_KGTDXOFZ=__webpack_require__("./node_modules/@chakra-ui/tabs/dist/chunk-KGTDXOFZ.mjs"),TextWithLink=__webpack_require__("./src/components/navigation/TextWithLink.js"),CommandBox=__webpack_require__("./src/components/output/CommandBox.js"),AlertHelper=__webpack_require__("./src/components/tool/guide/Config/AlertHelper.js"),InstructionHeading=__webpack_require__("./src/components/tool/guide/Instructions/components/InstructionHeading.js"),InstructionText=__webpack_require__("./src/components/tool/guide/Instructions/components/InstructionText.js");function singularityContainerName(hardware,gpuVendor){let containerName="hf_pipeline.sif";return"GPU"===hardware?"NVIDIA"===gpuVendor?containerName="hf_pipeline_nvidia.sif":"AMD"===gpuVendor&&(containerName="hf_pipeline_amd.sif"):"CPU"===hardware&&(containerName="hf_pipeline_cpu.sif"),containerName}var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function SingularityBuildInstructions(_ref){let{hardware,gpuVendor}=_ref;const containerName=singularityContainerName(hardware,gpuVendor);let containerTag="cpu";return"GPU"===hardware&&("NVIDIA"===gpuVendor?containerTag="nvidia":"AMD"===gpuVendor&&(containerTag="amd")),(0,jsx_runtime.jsx)(CommandBox.Z,{command:`singularity build ${containerName} docker://ghcr.io/eresearchqut/ai-toolbox/hf_pipeline:${containerTag}`})}function SingularityRunInstructions(_ref2){let{hardware,gpuVendor,service}=_ref2;const args=[];"GPU"===hardware&&args.push("--nv"),"Lyra"===service&&args.push("--bind /:/lyra","--bind /work:/work","--contain","--cleanenv");const argsString=args.length>0?args.join(" ")+" ":"",containerLocation="Lyra"===service?"/work/ai-toolbox/containers/":"";let containerName=singularityContainerName(hardware,gpuVendor);return(0,jsx_runtime.jsx)(CommandBox.Z,{command:`singularity run ${argsString}${containerLocation}${containerName} bash`})}function InstallInstructions(_ref3){let{hardware,gpuVendor,service,environment,tool}=_ref3;const isWorkstation=["rVDI","Local"].includes(service),isWorkstationNotebook=isWorkstation&&"Notebook"===tool;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Singularity"===environment&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[isWorkstation&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(InstructionHeading.Z,{children:"Install Singularity (if it has not been installed)"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:(0,jsx_runtime.jsx)(TextWithLink.Z,{textBeforeLink:"Follow the instructions ",link:{href:"https://sylabs.io/docs/",text:"here",color:"blue.500",isExternal:!0},textAfterLink:" to install singularity."})}),(0,jsx_runtime.jsx)(InstructionHeading.Z,{children:"Set up the container"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Build the container:"}),(0,jsx_runtime.jsx)(SingularityBuildInstructions,{hardware,gpuVendor})]}),"Lyra"===service&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(InstructionHeading.Z,{children:"Set up the container"})}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Run the container:"}),(0,jsx_runtime.jsx)(SingularityRunInstructions,{hardware,gpuVendor,service})]}),"Conda"===environment&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["JupyterHub"!==service&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(InstructionHeading.Z,{children:"Install Conda (if it has not been installed)"}),(0,jsx_runtime.jsxs)(chunk_GTRZJDIL.m,{children:[(0,jsx_runtime.jsxs)(chunk_BXDFYXZJ.t,{children:[(0,jsx_runtime.jsx)(chunk_IAXSQ4X2.O,{children:"mamba"}),(0,jsx_runtime.jsx)(chunk_IAXSQ4X2.O,{children:"conda"})]}),(0,jsx_runtime.jsxs)(chunk_4YMKQ5D4.n,{children:[(0,jsx_runtime.jsxs)(chunk_KGTDXOFZ.x,{children:[(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Download the latest version of micromamba"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"wget https://raw.githubusercontent.com/mamba-org/micromamba-releases/main/install.sh"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Run the installer and follow the prompts to install micromamba:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"bash install.sh -p ~/micromamba"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Create an alias for micromamba"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"echo 'alias conda=micromamba' >> ~/.bashrc"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Refresh the shell:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"source ~/.bashrc"})]}),(0,jsx_runtime.jsxs)(chunk_KGTDXOFZ.x,{children:[(0,jsx_runtime.jsx)(AlertHelper.Z,{alertType:"warning",alertDismissible:!1,children:"Packages take a long time to install with conda. We recommend using mamba instead."}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Download the latest version of miniconda:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Run the installer and follow the prompts to install conda:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"bash Miniconda3-latest-Linux-x86_64.sh"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Refresh the shell:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"source ~/.bashrc"})]})]})]})]}),(0,jsx_runtime.jsx)(InstructionHeading.Z,{children:"Set up the conda environment"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Create the conda environment (if it doesn't exist):"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Create the conda environment:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"conda create --name hf"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Activate the conda environment:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"conda activate hf"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Install the transformers package:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"conda install -c huggingface -c conda-forge transformers"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Install pytorch:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"conda install -c pytorch -c nvidia -c conda-forge pytorch torchvision torchaudio pytorch-cuda=12.1"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Install the gradio package:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"conda install -c conda-forge gradio"}),isWorkstationNotebook&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Install JupyterLab:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"conda install -c conda-forge jupyterlab"})]})]}),"venv"===environment&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[isWorkstation&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(InstructionHeading.Z,{children:"Install Python (if it has not been installed)"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:(0,jsx_runtime.jsx)(TextWithLink.Z,{textBeforeLink:"Follow the instructions ",link:{href:"https://www.python.org/downloads/",text:"here",color:"blue.500",isExternal:!0},textAfterLink:" to install python."})})]}),"Lyra"===service&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(InstructionHeading.Z,{children:"Python module"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Source the module script:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"source /etc/profile.d/modules.sh"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Load the python module:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"module load python/3.10.8-gcccore-12.2.0-bare"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Check the python version"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"python --version"})]}),(0,jsx_runtime.jsx)(InstructionHeading.Z,{children:"Set up the virtual environment"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Create the virtual environment (if it doesn't exist):"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"python -m venv hf-venv"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Activate the virtual environment:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"source hf-venv/bin/activate"}),(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Install the base dependencies:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"pip install gradio 'transformers[torch]'"}),isWorkstationNotebook&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(InstructionText.Z,{children:"Install JupyterLab:"}),(0,jsx_runtime.jsx)(CommandBox.Z,{command:"pip install jupyterlab"})]})]})]})}InstallInstructions.__docgenInfo={description:"",methods:[],displayName:"InstallInstructions"}}}]);